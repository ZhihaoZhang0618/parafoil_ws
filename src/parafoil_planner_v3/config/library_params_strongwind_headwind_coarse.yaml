parafoil_planner_v3:
  ros__parameters:
    generation:
      method: "gpm"            # template | gpm

      # Coarse strong-wind grid (fast-to-generate; intended for coarse KNN stage).
      # Focus on wind_ratio >= ~1 (for PolarTable V_air_max ~= 4.44 m/s).
      wind_speeds: [4.0, 6.0, 8.0, 10.0, 12.0]
      wind_directions: [0, 45, 90, 135, 180, 225, 270, 315]
      initial_altitudes: [30, 50, 70, 90]
      # Include short downwind distances to enable "slow drift" behaviors.
      target_distances: [30, 50, 80, 120, 180]
      target_bearings: [0, 45, 90, 135, 180, 225, 270, 315]

      trajectory_types: ["DIRECT", "S_TURN"]
      num_workers: "auto"

      gpm:
        method: "SLSQP"
        solve_mode: "least_squares"
        dynamics_mode: "simplified"  # keep coarse fast/stable
        num_nodes: 12
        scheme: "LGL"
        max_iterations: 250
        tolerance: 1.0e-6

        # NOTE: In strong wind, feasibility dominates; keep u_ref shaping light.
        w_u_ref: 0.2
        delta_a_amp: 0.4
        s_turn_cycles: 2.0
        rollout_dt: 0.2

        brake_min: 0.0
        brake_max: 0.6
        brake_fallback: 0.2

        max_violation_accept: 0.5

        # Least-squares options
        lsq_max_nfev: 150
        lsq_w_dynamics: 1.0
        lsq_w_boundary: 30.0
        lsq_w_ineq: 30.0
        u_ref_min: 0.001
        u_ref_max: 1.0
        lsq_x_scale: "jac"
        lsq_diag_grad_max: 50
        lsq_x0_bound_eps: 0.001

        # Shape constraints (post-check) - slightly relaxed for strong-wind turning.
        shape_enforce: true
        shape_turn_eps_deg: 3.0
        direct_max_total_turn_deg: 120.0
        direct_max_net_turn_deg: 90.0
        s_turn_min_total_turn_deg: 90.0
        s_turn_max_net_turn_deg: 90.0
        s_turn_min_sign_changes: 1

        # Strong-wind extensions
        reachability_filter_enable: true
        reachability_margin_mps: 0.3
        reachability_min_progress_mps: 0.0
        strong_wind_ratio_trigger: 0.8
        strong_wind_init_yaw_mode: "req_air"   # none|req_air|upwind

